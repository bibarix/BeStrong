<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="beStrong">
<meta name="theme-color" content="#0a0f1e">
<title>beStrong</title>
<link rel="apple-touch-icon" href="icon.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg:       #0a0f1e;
  --bg2:      #101828;
  --card:     #131d30;
  --card2:    #1a2640;
  --border:   #1f2f48;
  --accent:   #4f9cf9;
  --accent2:  #7fb8fb;
  --green:    #34d399;
  --green2:   #a7f3d0;
  --gold:     #f0b429;
  --text:     #f0f4ff;
  --muted:    #6b82a8;
  --muted2:   #4a5f80;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

html { height: -webkit-fill-available; }

body {
  font-family: 'Outfit', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  min-height: -webkit-fill-available;
  overflow-x: hidden;
  padding-bottom: calc(32px + env(safe-area-inset-bottom));
}

/* Atmospheric background */
body::before {
  content: '';
  position: fixed; inset: 0; z-index: 0;
  background:
    radial-gradient(ellipse 70% 50% at 15% 0%, rgba(79,156,249,0.10) 0%, transparent 60%),
    radial-gradient(ellipse 50% 60% at 85% 90%, rgba(52,211,153,0.07) 0%, transparent 55%),
    radial-gradient(ellipse 80% 40% at 50% 50%, rgba(10,15,30,0.6) 0%, transparent 100%);
  pointer-events: none;
}

/* Subtle grid texture */
body::after {
  content: '';
  position: fixed; inset: 0; z-index: 0;
  background-image: linear-gradient(rgba(79,156,249,0.03) 1px, transparent 1px),
                    linear-gradient(90deg, rgba(79,156,249,0.03) 1px, transparent 1px);
  background-size: 40px 40px;
  pointer-events: none;
}

.app {
  position: relative; z-index: 1;
  max-width: 430px; margin: 0 auto;
  padding: 0 20px;
}

/* â”€â”€â”€ HEADER â”€â”€â”€ */
.header {
  padding: calc(56px + env(safe-area-inset-top)) 0 0;
  display: flex; align-items: flex-start; justify-content: space-between;
}
.header-left {}
.app-label {
  font-size: 11px; font-weight: 500; letter-spacing: 5px;
  text-transform: uppercase; color: var(--accent); margin-bottom: 6px;
}
.app-title {
  font-family: 'Playfair Display', serif;
  font-size: 40px; font-weight: 700; color: var(--text);
  line-height: 1; letter-spacing: -1px;
}
.app-title span { color: var(--accent); }
.app-brand {
  display: flex; align-items: center; gap: 8px; margin-top: 7px;
}
.app-brand-line {
  height: 1px; width: 18px;
  background: linear-gradient(to right, var(--accent), transparent);
}
.app-brand-name {
  font-family: 'Outfit', sans-serif;
  font-size: 10px; font-weight: 600;
  letter-spacing: 5px; text-transform: uppercase;
  color: var(--muted); 
  background: linear-gradient(90deg, var(--accent2), var(--muted));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  background-clip: text;
}
.app-brand-line-right {
  height: 1px; width: 18px;
  background: linear-gradient(to left, var(--accent), transparent);
}
.header-badge {
  background: var(--card2); border: 1px solid var(--border);
  border-radius: 50px; padding: 8px 16px;
  font-size: 13px; font-weight: 500; color: var(--muted);
  white-space: nowrap; margin-top: 8px;
}
.header-badge strong { color: var(--accent2); }

/* â”€â”€â”€ QUOTE â”€â”€â”€ */
.quote-card {
  background: linear-gradient(135deg, rgba(79,156,249,0.1), rgba(52,211,153,0.06));
  border: 1px solid rgba(79,156,249,0.2);
  border-radius: 18px; padding: 20px 22px; margin-top: 24px;
  position: relative; overflow: hidden;
}
.quote-card::before {
  content: '"';
  position: absolute; top: -10px; left: 12px;
  font-family: 'Playfair Display', serif; font-size: 100px;
  color: rgba(79,156,249,0.08); line-height: 1; pointer-events: none;
}
.quote-text {
  font-family: 'Playfair Display', serif;
  font-size: 17px; font-style: italic; font-weight: 400;
  color: var(--text); line-height: 1.55; position: relative;
}
.quote-author {
  font-size: 11px; color: var(--accent); letter-spacing: 3px;
  text-transform: uppercase; margin-top: 10px; font-weight: 500;
}

/* â”€â”€â”€ PROGRESS BAR â”€â”€â”€ */
.progress-section { margin-top: 24px; }
.progress-header {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 10px;
}
.progress-title { font-size: 13px; font-weight: 500; color: var(--muted); letter-spacing: 0.5px; }
.progress-count {
  font-family: 'Playfair Display', serif;
  font-size: 22px; font-weight: 700; color: var(--text);
}
.progress-count span { color: var(--muted2); font-size: 16px; }
.progress-track {
  height: 6px; background: var(--card2); border-radius: 3px; overflow: hidden;
}
.progress-fill {
  height: 100%; border-radius: 3px;
  background: linear-gradient(90deg, var(--accent), var(--green));
  transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 0 12px rgba(79,156,249,0.5);
  width: 0%;
}
.progress-pct {
  text-align: right; font-size: 11px; color: var(--muted);
  margin-top: 6px; letter-spacing: 1px;
}

/* â”€â”€â”€ SECTION LABEL â”€â”€â”€ */
.section-label {
  font-size: 11px; font-weight: 600; letter-spacing: 4px;
  text-transform: uppercase; color: var(--muted); margin: 28px 0 14px;
  display: flex; align-items: center; gap: 10px;
}
.section-label::after {
  content: ''; flex: 1; height: 1px;
  background: linear-gradient(to right, var(--border), transparent);
}

/* â”€â”€â”€ CALENDAR GRID â”€â”€â”€ */
.calendar-grid {
  display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px;
}

.day-cell {
  aspect-ratio: 1;
  border-radius: 12px;
  background: var(--card);
  border: 1px solid var(--border);
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  cursor: pointer; position: relative; overflow: hidden;
  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  gap: 3px;
}
.day-cell::before {
  content: ''; position: absolute; inset: 0;
  background: linear-gradient(135deg, rgba(79,156,249,0.06), transparent);
  opacity: 0; transition: opacity 0.25s;
}
.day-cell:active { transform: scale(0.92); }
.day-cell:hover::before { opacity: 1; }

.day-cell.done {
  background: linear-gradient(135deg, rgba(52,211,153,0.18), rgba(52,211,153,0.08));
  border-color: rgba(52,211,153,0.35);
}
.day-cell.today {
  border-color: var(--accent);
  box-shadow: 0 0 0 1px var(--accent), 0 0 16px rgba(79,156,249,0.2);
}
.day-cell.future { opacity: 0.45; cursor: default; }

.day-num {
  font-family: 'Playfair Display', serif;
  font-size: 17px; font-weight: 700;
  color: var(--muted); line-height: 1;
  transition: color 0.25s;
}
.day-cell.done .day-num { color: var(--green2); }
.day-cell.today .day-num { color: var(--accent2); }

.day-check {
  font-size: 12px; line-height: 1;
  opacity: 0; transform: scale(0.5);
  transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}
.day-cell.done .day-check { opacity: 1; transform: scale(1); }

.day-dot {
  width: 4px; height: 4px; border-radius: 50%;
  background: var(--accent); opacity: 0;
  transition: opacity 0.25s;
}
.day-cell.today .day-dot { opacity: 1; }

/* Yesterday grace window */
.day-cell.yesterday {
  border-color: rgba(240,180,41,0.4);
  background: linear-gradient(135deg, rgba(240,180,41,0.08), rgba(28,46,28,0.8));
}
.day-cell.yesterday .day-num { color: var(--gold); }
.yesterday-tag {
  font-size: 8px; font-weight: 600; letter-spacing: 1px;
  text-transform: uppercase; color: var(--gold);
  opacity: 0.8; line-height: 1;
}

/* â”€â”€â”€ NOTIFICATION BUTTON â”€â”€â”€ */
.notif-card {
  margin-top: 28px;
  background: var(--card); border: 1px solid var(--border);
  border-radius: 18px; padding: 20px;
}
.notif-header { display: flex; align-items: center; gap: 12px; margin-bottom: 14px; }
.notif-icon {
  width: 42px; height: 42px; border-radius: 12px;
  background: rgba(240,180,41,0.12); border: 1px solid rgba(240,180,41,0.25);
  display: flex; align-items: center; justify-content: center; font-size: 20px;
}
.notif-title { font-size: 15px; font-weight: 600; color: var(--text); }
.notif-sub { font-size: 12px; color: var(--muted); margin-top: 2px; }
.notif-btn {
  width: 100%; padding: 14px;
  border-radius: 12px; border: none;
  background: linear-gradient(135deg, var(--accent), #3a7fd5);
  color: #fff; font-family: 'Outfit', sans-serif;
  font-size: 14px; font-weight: 600; cursor: pointer;
  transition: all 0.2s; letter-spacing: 0.3px;
  box-shadow: 0 4px 20px rgba(79,156,249,0.3);
}
.notif-btn:active { transform: scale(0.97); filter: brightness(0.9); }
.notif-btn:disabled {
  background: var(--card2); color: var(--muted); box-shadow: none; cursor: default;
}
.notif-schedule {
  display: grid; grid-template-columns: repeat(5, 1fr);
  gap: 6px; margin-top: 14px;
}
.notif-time {
  background: var(--card2); border: 1px solid var(--border);
  border-radius: 8px; padding: 6px 4px;
  font-size: 10px; font-weight: 500; color: var(--muted);
  text-align: center; letter-spacing: 0.3px;
  transition: all 0.3s;
}
.notif-time.fired { border-color: var(--green); color: var(--green); background: rgba(52,211,153,0.08); }
.notif-time.active { border-color: var(--gold); color: var(--gold); background: rgba(240,180,41,0.08); }

/* â”€â”€â”€ STREAK â”€â”€â”€ */
.streak-row {
  display: flex; gap: 10px; margin-top: 14px;
}
.streak-card {
  flex: 1; background: var(--card); border: 1px solid var(--border);
  border-radius: 16px; padding: 16px; text-align: center;
}
.streak-num {
  font-family: 'Playfair Display', serif; font-size: 32px; font-weight: 700;
  line-height: 1; color: var(--text);
}
.streak-lbl { font-size: 11px; color: var(--muted); margin-top: 4px; letter-spacing: 0.5px; }
.streak-card.fire .streak-num { color: var(--gold); }
.streak-card.check .streak-num { color: var(--green); }

/* â”€â”€â”€ TOAST â”€â”€â”€ */
.toast {
  position: fixed; bottom: calc(28px + env(safe-area-inset-bottom)); left: 50%;
  transform: translateX(-50%) translateY(100px);
  background: var(--card2); border: 1px solid var(--border);
  border-radius: 50px; padding: 12px 24px;
  font-size: 14px; font-weight: 500; color: var(--text);
  white-space: nowrap; z-index: 999;
  transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  box-shadow: 0 8px 32px rgba(0,0,0,0.5);
  pointer-events: none;
}
.toast.show { transform: translateX(-50%) translateY(0); }

/* â”€â”€â”€ COMPLETION BANNER â”€â”€â”€ */
.done-banner {
  background: linear-gradient(135deg, rgba(52,211,153,0.15), rgba(52,211,153,0.05));
  border: 1px solid rgba(52,211,153,0.3);
  border-radius: 18px; padding: 24px; text-align: center;
  margin-top: 24px; display: none;
}
.done-banner.show { display: block; animation: fadeUp 0.5s ease; }
.done-banner .trophy { font-size: 48px; margin-bottom: 10px; }
.done-banner h3 {
  font-family: 'Playfair Display', serif; font-size: 26px; font-weight: 700;
  color: var(--green2); margin-bottom: 6px;
}
.done-banner p { font-size: 14px; color: var(--muted); line-height: 1.5; }

@keyframes fadeUp {
  from { opacity: 0; transform: translateY(16px); }
  to { opacity: 1; transform: translateY(0); }
}
@keyframes shimmer {
  0% { background-position: -200% center; }
  100% { background-position: 200% center; }
}

.footer { height: 20px; }

/* â”€â”€â”€ RESET BUTTON â”€â”€â”€ */
.reset-btn {
  display: block; width: 100%; margin-top: 16px;
  padding: 13px; border-radius: 12px;
  background: transparent; border: 1px solid var(--border);
  color: var(--muted2); font-family: 'Outfit', sans-serif;
  font-size: 13px; font-weight: 500; cursor: pointer;
  letter-spacing: 0.3px; transition: all 0.2s;
}
.reset-btn:active { background: rgba(255,80,80,0.08); border-color: rgba(255,80,80,0.3); color: #ff6b6b; }

/* â”€â”€â”€ CONFIRM MODAL â”€â”€â”€ */
.confirm-overlay {
  position: fixed; inset: 0; z-index: 200;
  background: rgba(0,0,0,0.75);
  backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
  display: flex; align-items: center; justify-content: center;
  padding: 24px;
  opacity: 0; pointer-events: none;
  transition: opacity 0.3s ease;
}
.confirm-overlay.open { opacity: 1; pointer-events: all; }
.confirm-box {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 24px;
  padding: 32px 28px 28px;
  width: 100%; max-width: 340px;
  transform: scale(0.88) translateY(20px);
  transition: transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
  text-align: center;
}
.confirm-overlay.open .confirm-box { transform: scale(1) translateY(0); }
.confirm-icon { font-size: 48px; margin-bottom: 14px; line-height: 1; }
.confirm-title {
  font-family: 'Playfair Display', serif;
  font-size: 24px; font-weight: 700;
  color: var(--text); margin-bottom: 12px;
}
.confirm-msg {
  font-size: 14px; color: var(--muted);
  line-height: 1.6; margin-bottom: 28px;
}
.confirm-msg strong { color: #ff8080; font-weight: 600; }
.confirm-btns { display: flex; flex-direction: column; gap: 10px; }
.confirm-cancel {
  padding: 15px; border-radius: 14px;
  background: var(--card2); border: 1px solid var(--border);
  color: var(--text); font-family: 'Outfit', sans-serif;
  font-size: 15px; font-weight: 600; cursor: pointer;
  transition: all 0.2s;
}
.confirm-cancel:active { filter: brightness(1.15); }
.confirm-yes {
  padding: 15px; border-radius: 14px;
  background: linear-gradient(135deg, #ff5252, #c62828);
  border: none; color: #fff;
  font-family: 'Outfit', sans-serif;
  font-size: 15px; font-weight: 600; cursor: pointer;
  transition: all 0.2s;
  box-shadow: 0 4px 20px rgba(255,82,82,0.35);
}
.confirm-yes:active { transform: scale(0.97); filter: brightness(0.9); }
</style>
</head>
<body>
<div class="app">
  <!-- Header -->
  <div class="header">
    <div class="header-left">
      <div class="app-label">30-Day Challenge</div>
      <div class="app-title">be<span>Strong</span></div>
      <div class="app-brand">
        <div class="app-brand-line"></div>
        <div class="app-brand-name">Bibarix</div>
        <div class="app-brand-line-right"></div>
      </div>
    </div>
    <div class="header-badge">Day <strong id="todayNum">1</strong> of 30</div>
  </div>

  <!-- Quote -->
  <div class="quote-card">
    <div class="quote-text" id="quoteText">Small daily habits create strong results.</div>
    <div class="quote-author">Daily reminder</div>
  </div>

  <!-- Progress -->
  <div class="progress-section">
    <div class="progress-header">
      <div class="progress-title">POSTURE CHALLENGE PROGRESS</div>
      <div class="progress-count" id="progressCount">0 <span>/ 30</span></div>
    </div>
    <div class="progress-track"><div class="progress-fill" id="progressFill"></div></div>
    <div class="progress-pct" id="progressPct">0% complete</div>
  </div>

  <!-- Stats -->
  <div class="streak-row">
    <div class="streak-card fire">
      <div class="streak-num" id="streakNum">0</div>
      <div class="streak-lbl">ğŸ”¥ day streak</div>
    </div>
    <div class="streak-card check">
      <div class="streak-num" id="doneNum">0</div>
      <div class="streak-lbl">âœ… days done</div>
    </div>
    <div class="streak-card">
      <div class="streak-num" id="leftNum">30</div>
      <div class="streak-lbl">ğŸ“… days left</div>
    </div>
  </div>

  <!-- Calendar -->
  <div class="section-label">30-Day Calendar</div>
  <div class="calendar-grid" id="calendarGrid"></div>

  <!-- Done Banner -->
  <div class="done-banner" id="doneBanner">
    <div class="trophy">ğŸ†</div>
    <h3>Challenge Complete!</h3>
    <p>30 days of discipline. Your posture â€” and your spine â€” thank you. You are strong.</p>
  </div>

  <!-- Notifications -->
  <div class="notif-card">
    <div class="notif-header">
      <div class="notif-icon">ğŸ””</div>
      <div>
        <div class="notif-title">Daily Reminders</div>
        <div class="notif-sub">10 reminders between 8 AM â€“ 10 PM</div>
      </div>
    </div>
    <button class="notif-btn" id="notifBtn" onclick="requestNotifications()">
      Enable Daily Reminders
    </button>
    <div class="notif-schedule" id="notifSchedule"></div>
  </div>

  <!-- Reset -->
  <button class="reset-btn" onclick="resetChallenge()">â†º Restart Challenge from Day 1</button>

  <div class="footer"></div>
</div>

<!-- Confirm Reset Modal -->
<div class="confirm-overlay" id="confirmModal" onclick="cancelReset()">
  <div class="confirm-box" onclick="event.stopPropagation()">
    <div class="confirm-icon">âš ï¸</div>
    <div class="confirm-title">Restart Challenge?</div>
    <div class="confirm-msg">This will erase <strong>all your progress</strong> and start fresh from Day&nbsp;1 today. This cannot be undone.</div>
    <div class="confirm-btns">
      <button class="confirm-cancel" onclick="cancelReset()">No, Keep Progress</button>
      <button class="confirm-yes" onclick="confirmReset()">Yes, Restart</button>
    </div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
// â”€â”€ QUOTES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const QUOTES = [
  "Small daily habits create strong results.",
  "Your posture reflects your confidence.",
  "Stand tall. Live strong. Be proud.",
  "Discipline is the bridge between goals and achievement.",
  "Every rep, every stretch â€” it adds up.",
  "Your body is your home. Take care of it.",
  "Consistency beats perfection every time.",
  "Strength is built one day at a time.",
  "The spine is the tree of life. Guard it.",
  "30 days to a better you. Today is day one."
];

// â”€â”€ NOTIFICATION TIMES (10 reminders, 8amâ€“10pm) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const NOTIF_TIMES = [
  { h: 8,  m: 0,  label: '8:00 AM' },
  { h: 9,  m: 30, label: '9:30 AM' },
  { h: 11, m: 0,  label: '11:00 AM' },
  { h: 12, m: 30, label: '12:30 PM' },
  { h: 14, m: 0,  label: '2:00 PM' },
  { h: 15, m: 30, label: '3:30 PM' },
  { h: 17, m: 0,  label: '5:00 PM' },
  { h: 18, m: 30, label: '6:30 PM' },
  { h: 20, m: 0,  label: '8:00 PM' },
  { h: 22, m: 0,  label: '10:00 PM' },
];

const NOTIF_MESSAGES = [
  { title: "beStrong ğŸ’ª", body: "Drink water ğŸ’§ and fix your posture right now." },
  { title: "beStrong ğŸ§", body: "Stand up and do your back exercises." },
  { title: "beStrong ğŸŒ¿", body: "Roll your shoulders back. Chin up. You've got this." },
  { title: "beStrong âš¡", body: "Time for a posture check! Sit or stand tall." },
  { title: "beStrong ğŸ’§", body: "Hydrate & stretch. Your spine will thank you." },
  { title: "beStrong ğŸ†", body: "Quick reminder: chest out, shoulders back!" },
  { title: "beStrong ğŸ”¥", body: "You're building strength every single day." },
  { title: "beStrong ğŸŒŸ", body: "Posture correction moment â€” pause and align." },
  { title: "beStrong ğŸ’", body: "Strong posture, strong mind. Check in now." },
  { title: "beStrong ğŸŒ™", body: "Last reminder: finish strong. Great posture today?" },
];

// â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let state = {
  startDate: null,
  completed: {},
  streak: 0,
  lastDate: null,
  notifEnabled: false,
};

function getToday() { return new Date().toISOString().split('T')[0]; }

function daysBetween(a, b) {
  return Math.floor((new Date(b) - new Date(a)) / 86400000);
}

function loadState() {
  const raw = localStorage.getItem('bestrong_v1');
  if (raw) {
    Object.assign(state, JSON.parse(raw));
  } else {
    // Fresh start â€” Day 1 was yesterday, Day 2 is today
    const _y = new Date(); _y.setDate(_y.getDate() - 1);
    state.startDate = _y.toISOString().split('T')[0];
    state.completed = {};
    state.streak = 0;
    state.lastDate = null;
    state.notifEnabled = false;
    saveState();
  }
  // Streak reset if more than 1 day missed
  const today = getToday();
  if (state.lastDate && state.lastDate !== today) {
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);
    if (state.lastDate !== yesterday.toISOString().split('T')[0]) {
      state.streak = 0;
    }
  }
}

function saveState() { localStorage.setItem('bestrong_v1', JSON.stringify(state)); }

function resetChallenge() {
  document.getElementById('confirmModal').classList.add('open');
}
function confirmReset() {
  document.getElementById('confirmModal').classList.remove('open');
  localStorage.removeItem('bestrong_v1');
  state.startDate = getToday();
  state.completed = {};
  state.streak = 0;
  state.lastDate = null;
  state.notifEnabled = false;
  saveState();
  document.getElementById('doneBanner').classList.remove('show');
  const notifBtn = document.getElementById('notifBtn');
  notifBtn.textContent = 'Enable Daily Reminders';
  notifBtn.disabled = false;
  renderCalendar();
  updateStats();
  setQuote();
  showToast('Challenge reset! Day 1 starts today ğŸ’ª');
}
function cancelReset() {
  document.getElementById('confirmModal').classList.remove('open');
}

// â”€â”€ CALENDAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getDayDate(dayIndex) {
  const d = new Date(state.startDate);
  d.setDate(d.getDate() + dayIndex);
  return d.toISOString().split('T')[0];
}

function getCurrentDayIndex() {
  return Math.min(29, Math.max(0, daysBetween(state.startDate, getToday())));
}

function getYesterday() {
  const d = new Date();
  d.setDate(d.getDate() - 1);
  return d.toISOString().split('T')[0];
}

function renderCalendar() {
  const grid = document.getElementById('calendarGrid');
  const todayIdx = getCurrentDayIndex();
  const yesterdayStr = getYesterday();
  grid.innerHTML = '';

  for (let i = 0; i < 30; i++) {
    const dateStr = getDayDate(i);
    const done = !!state.completed[dateStr];
    const isToday = i === todayIdx;
    const isFuture = i > todayIdx;
    // Allow yesterday if it hasn't been marked done yet (grace window)
    const isYesterday = dateStr === yesterdayStr && !done;

    const cell = document.createElement('div');
    cell.className = `day-cell${done ? ' done' : ''}${isToday ? ' today' : ''}${isFuture ? ' future' : ''}${isYesterday ? ' yesterday' : ''}`;
    cell.innerHTML = `
      <div class="day-dot"></div>
      <div class="day-num">${i + 1}</div>
      <div class="day-check">âœ…</div>
      ${isYesterday ? '<div class="yesterday-tag">yesterday</div>' : ''}
    `;
    // Today (not done) OR yesterday (not done) are tappable
    if ((isToday || isYesterday) && !done) cell.onclick = () => toggleDay(i, dateStr);
    if (done) cell.style.cursor = 'default';
    grid.appendChild(cell);
  }
}

function toggleDay(idx, dateStr) {
  const wasCompleted = !!state.completed[dateStr];
  if (wasCompleted) {
    // Locked â€” cannot uncheck
    showToast('âœ… Already completed â€” locked!');
    return;
  }
  state.completed[dateStr] = true;
  state.lastDate = getToday();
  recalcStreak();
  showToast(`Day ${idx + 1} completed! ğŸ’ª`);
  saveState();
  renderCalendar();
  updateStats();
}

function recalcStreak() {
  let streak = 0;
  const today = getToday();
  let cursor = new Date(today);
  while (true) {
    const d = cursor.toISOString().split('T')[0];
    if (state.completed[d]) {
      streak++;
      cursor.setDate(cursor.getDate() - 1);
    } else break;
  }
  state.streak = streak;
}

function updateStats() {
  const done = Object.keys(state.completed).length;
  const pct = Math.round((done / 30) * 100);
  document.getElementById('progressCount').innerHTML = `${done} <span>/ 30</span>`;
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('progressPct').textContent = pct + '% complete';
  document.getElementById('streakNum').textContent = state.streak;
  document.getElementById('doneNum').textContent = done;
  document.getElementById('leftNum').textContent = Math.max(0, 30 - done);
  document.getElementById('todayNum').textContent = Math.min(30, getCurrentDayIndex() + 1);

  if (done === 30) {
    document.getElementById('doneBanner').classList.add('show');
  }
}

// â”€â”€ QUOTE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setQuote() {
  const day = getCurrentDayIndex();
  document.getElementById('quoteText').textContent = QUOTES[day % QUOTES.length];
}

// â”€â”€ NOTIFICATIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderNotifSchedule() {
  const el = document.getElementById('notifSchedule');
  const now = new Date();
  const nowMins = now.getHours() * 60 + now.getMinutes();
  el.innerHTML = NOTIF_TIMES.map(t => {
    const tMins = t.h * 60 + t.m;
    const fired = nowMins > tMins;
    const active = Math.abs(nowMins - tMins) < 20;
    return `<div class="notif-time${fired ? ' fired' : ''}${active ? ' active' : ''}">${t.label}</div>`;
  }).join('');
}

async function requestNotifications() {
  if (!('Notification' in window)) {
    showToast('Notifications not supported in this browser');
    return;
  }

  const perm = await Notification.requestPermission();
  if (perm !== 'granted') {
    showToast('Please allow notifications in Settings');
    return;
  }

  state.notifEnabled = true;
  saveState();
  scheduleNotifications();
  document.getElementById('notifBtn').textContent = 'âœ… Reminders Enabled';
  document.getElementById('notifBtn').disabled = true;
  showToast('10 daily reminders scheduled! ğŸ””');
}

function scheduleNotifications() {
  // For PWA: schedule all 10 notifications for today
  // (re-run this daily; Service Worker would be ideal but requires HTTPS + SW file)
  const now = new Date();
  NOTIF_TIMES.forEach((t, i) => {
    const target = new Date();
    target.setHours(t.h, t.m, 0, 0);
    let delay = target - now;
    if (delay < 0) delay += 86400000; // next day if already passed
    setTimeout(() => {
      if (Notification.permission === 'granted') {
        const msg = NOTIF_MESSAGES[i];
        new Notification(msg.title, {
          body: msg.body,
          icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><rect width="64" height="64" rx="14" fill="%230a0f1e"/><text y="46" x="8" font-size="44">ğŸ’ª</text></svg>',
          badge: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><rect width="64" height="64" fill="%234f9cf9"/></svg>',
          tag: `bestrong-${i}`,
          requireInteraction: false,
        });
      }
      // Reschedule for tomorrow
      setTimeout(() => scheduleNotification(i), 86400000 - delay);
    }, delay);
  });
}

function scheduleNotification(i) {
  const t = NOTIF_TIMES[i];
  const msg = NOTIF_MESSAGES[i];
  const now = new Date();
  const target = new Date();
  target.setHours(t.h, t.m, 0, 0);
  let delay = target - now;
  if (delay < 0) delay += 86400000;
  setTimeout(() => {
    if (Notification.permission === 'granted') {
      new Notification(msg.title, {
        body: msg.body,
        tag: `bestrong-${i}`,
        icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><rect width="64" height="64" rx="14" fill="%230a0f1e"/><text y="46" x="8" font-size="44">ğŸ’ª</text></svg>',
      });
    }
    setTimeout(() => scheduleNotification(i), 86400000);
  }, delay);
}

// â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let toastTimer;
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), 2400);
}

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
loadState();
setQuote();
renderCalendar();
updateStats();
renderNotifSchedule();

// Re-render notif schedule every minute
setInterval(renderNotifSchedule, 60000);

// Restore notifications if previously enabled
if (state.notifEnabled && Notification.permission === 'granted') {
  scheduleNotifications();
  document.getElementById('notifBtn').textContent = 'âœ… Reminders Enabled';
  document.getElementById('notifBtn').disabled = true;
}
</script>
</body>
</html>
